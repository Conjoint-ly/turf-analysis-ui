# Условия использования

---

Если предполагается использование графиков Google, то на странице уже должен быть загружен Google Chart

```html
<script
	type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"
></script>
```

# Поток данных

---

## Параметры

**`items`**  
Тип: массив

Массив с данными для `PivotTable`.

**Обратить внимание** - `PivotTable` и `Google Chart` не поддерживают `HTML`, данные должны быть очищены вне компонента перед использованием.

```javascript
    function reviver(key, value) {
        if (typeof value == "object") return value;

        return DOMPurify.sanitize(value, { ALLOWED_TAGS: [] });
    }

    import DOMPurify from "dompurify";

    var items = JSON.parse(items, reviver);
```

**`settings`**  
Тип: объект

Объект с обязательным параметром `options`, используется jQuery компонентом.

Для разных `predefined` используются [разные параметры](https://github.com/nicolaskruchten/pivottable/wiki/Parameters). Обертка из объекта сделана для возможного расширения компонента.

```json
    {
        "options": {}
    }
```

Дополнительно в `settings` могут быть указаны необязательные параметры:

-   **`hiddenAttributes`**  
    Тип: массив  
    Наименования атрибутов `JSON`, которые необходимо исключить из преобразования в `CSV`.

-   **`labels`**  
    Тип: объект  
    Объект с заменами заголовков атрибутов в наборе данных, в котором именем свойства является исходный заголовок, а значением свойства является желаемый заголовок.  
    Если пропущена пара для замены, то заголовок не меняется.  
    Переименование столбцов выполяется на этапе отображения, поэтому в объекте `settings.options` следует использовать оригинальные значения свойств.

-   **`controls`**  
    Тип: объект  
    Объект с логическими свойствами `unused` и `rules`, которые указывают отображать или нет по умолчанию столбцы с неиспользоваными полями и со строками/столбцами в `PivotTable`.

**`predefined`**  
Тип: логическое

Если истинное значение, то `PivotTable` будет без пользовательского интерфейса, в противном случае - компонент с пользовательским интерфейсом.

## События

**`optionsSet`**  
Параметры: объект

При обновлении `PivotTable` выбрасывается событие с `options` (не весь `settings`).

**Обратить внимание**:

1. первое обновление не выбрасывает событие;
2. из объекта в событии удаляются свойства:
    - `aggregators`
    - `controls`
    - `dataClass`
    - `derivers`
    - `filter`
    - `hiddenAttributes`
    - `renderers`
    - `labels`
    - `onRefresh`
    - `rendererOptions`

## Шина (Vue)

### Входящие события

**`pivot-table@refresh`**  
Параметры: нет

По событию происходит принудительная перерисовка. Посколько PivotTable компонент jQuery, то при изменении настроек необходимо переинициализировать компонент

# Хуки

---

**`mounted`**  
Для использования в качестве статического компонента. По событию происходит инициализация настроек и перерисовка компонента jQuery.

**`activated`**  
Для использования в качестве динамического компонента. По событию происходит принудительная перерисовка.
